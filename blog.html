<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog - Second Spring</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
      /* Page-scoped brand palette test (accessibility-updated) */
      body.theme-experiment {
        --plum: #5A4368;
        --gold: #CBA052;
        --cream: #FFF8F0;
        --taupe: #9C8E89;
        --charcoal: #2E2E2E;
        --orange: #F25C05;
        --blue: #247BA0;
        --green: #68B088; /* page-specific test */
        --light-gold: #D4A259;
        --purple: #6A4C93;
        --white: #FFFFFF;
        --black: #000000;
      }
    </style>
</head>
<body class="theme-experiment blog-page">
    <!-- Header Placeholder (auto-loaded from navigation.js) -->
    <div id="navigation-placeholder"></div>

    <!-- Latest Blog Posts - Masonry Style -->
    <section class="latest-blog-posts">
        <div class="container">
            <div class="latest-posts-header">
                <h2>Latest Wellness Wisdom</h2>
                <p>Stories, science, and ancient practices to help you find your rhythm</p>
            </div>
            <div class="masonry-grid" id="masonryGrid">
                <!-- Latest blog posts will be dynamically loaded here -->
            </div>
        </div>
    </section>

    <!-- Category Sections -->
    <section class="blog-categories">
        <div class="container">
            <!-- Popular Categories -->
            <div class="category-section">
                <div class="category-header">
                    <h2>Popular Categories</h2>
                    <p>Explore our most popular wellness topics</p>
                </div>
                <div class="category-grid" id="popularCategories">
                    <!-- Popular categories will be dynamically loaded here -->
                </div>
            </div>

            <!-- All Topics -->
            <div class="category-section">
                <div class="category-header">
                    <h2>All Topics</h2>
                    <p>Browse articles by wellness focus area</p>
                </div>
                <div class="category-grid" id="allTopics">
                    <!-- All topics will be dynamically loaded here -->
                </div>
            </div>
        </div>
    </section>


    <!-- Footer Placeholder (auto-loaded from navigation.js) -->
    <div id="footer-placeholder"></div>

    <script src="blog-posts.js"></script>
    <script src="navigation.js"></script>
    <script src="script.js"></script>
    <script>
        // Blog page specific functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Check URL parameters for topic or category filtering
            const urlParams = new URLSearchParams(window.location.search);
            const topicParam = urlParams.get('topic');
            const categoryParam = urlParams.get('category');
            
            // Load category sections
            loadCategorySections();
            
            // Load masonry-style latest posts with optional filtering
            if (topicParam) {
                const decodedTopic = decodeURIComponent(topicParam);
                loadMasonryPosts(decodedTopic);
            } else {
                loadMasonryPosts();
            }
        });


        // Load category sections
        function loadCategorySections() {
            loadPopularCategories();
            loadAllTopics();
        }

        function loadPopularCategories() {
            const popularContainer = document.getElementById('popularCategories');
            const VALID_CATEGORIES = {
                "Nourish – Food & Nutrition": [
                    "Hormone-Friendly Nutrition",
                    "Ayurveda & TCM Food Wisdom",
                    "Gut Health",
                    "Functional Foods & Herbs",
                    "Metabolism & Energy"
                ],
                "Flow – Lifestyle Harmony": [
                    "Stress & Energy Balance",
                    "Morning & Evening Rituals",
                    "Emotional Regulation",
                    "Work-Life Harmony",
                    "Seasonal & Cycle-Based Living"
                ],
                "Rest – Sleep & Recovery": [
                    "Sleep Hygiene",
                    "Night Sweats & Temperature Regulation",
                    "Mindful Wind-Down Practices",
                    "Restorative Breathing & Meditation",
                    "Sound & Music Therapy"
                ],
                "Move – Movement & Strength": [
                    "Strength & Mobility",
                    "Mindful Movement (Yoga, Tai Chi, Qigong)",
                    "Hormone-Safe Workouts",
                    "Core & Pelvic Health",
                    "Somatic Movement for Emotional Release"
                ],
                "Thrive – Healthcare & Support": [
                    "What to Ask Your Doctor",
                    "Lab Tests & Biomarkers",
                    "Hormone Therapy Options",
                    "Emotional Support & Mentorship",
                    "Integrative Care Approaches"
                ]
            };

            // Get categories with posts and sort by post count
            const categoriesWithPosts = [];
            Object.entries(VALID_CATEGORIES).forEach(([topic, categories]) => {
                categories.forEach(category => {
                    const count = getBlogPostsByCategory(category).length;
                    if (count > 0) {
                        categoriesWithPosts.push({ category, count, topic });
                    }
                });
            });

            // Sort by post count and take top 6
            const popularCategories = categoriesWithPosts
                .sort((a, b) => b.count - a.count)
                .slice(0, 6);

            popularContainer.innerHTML = popularCategories.map(item => {
                const icon = getTopicIcon(item.topic);
                const featuredText = getFeaturedText(item.topic);
                
                return `
                    <div class="category-box" data-category="${item.category}">
                        <div class="category-icon">
                            ${icon}
                        </div>
                        <h3 class="category-title">${item.category}</h3>
                        <p class="category-featured-text">${featuredText}</p>
                        <div class="category-meta">
                            <span class="category-count">${item.count} article${item.count !== 1 ? 's' : ''}</span>
                        </div>
                        <a href="blog.html?category=${encodeURIComponent(item.category)}" class="category-link">Explore Articles</a>
                    </div>
                `;
            }).join('');
        }

        function loadAllTopics() {
            const allTopicsContainer = document.getElementById('allTopics');
            const VALID_TOPICS = [
                "Nourish – Food & Nutrition",
                "Flow – Lifestyle Harmony", 
                "Rest – Sleep & Recovery",
                "Move – Movement & Strength",
                "Thrive – Healthcare & Support"
            ];

            allTopicsContainer.innerHTML = VALID_TOPICS.map(topic => {
                const count = getBlogPostsByTopic(topic).length;
                const icon = getTopicIcon(topic);
                const featuredText = getFeaturedText(topic);
                
                return `
                    <div class="category-box" data-topic="${topic}">
                        <div class="category-icon">
                            ${icon}
                        </div>
                        <h3 class="category-title">${topic}</h3>
                        <p class="category-featured-text">${featuredText}</p>
                        <div class="category-meta">
                            <span class="category-count">${count} article${count !== 1 ? 's' : ''}</span>
                        </div>
                        <a href="blog.html?topic=${encodeURIComponent(topic)}" class="category-link">Explore Articles</a>
                    </div>
                `;
            }).join('');
        }

        // Helper function to get topic icon (same as in blog-post.html)
        function getTopicIcon(topic) {
            const icons = {
                "Nourish – Food & Nutrition": `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                    <path d="M21 3v5h-5"></path>
                    <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                    <path d="M3 21v-5h5"></path>
                </svg>`,
                "Flow – Lifestyle Harmony": `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                    <path d="M2 17l10 5 10-5"></path>
                    <path d="M2 12l10 5 10-5"></path>
                </svg>`,
                "Rest – Sleep & Recovery": `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3 4-3 9-3 9 1.34 9 3z"></path>
                    <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
                </svg>`,
                "Move – Movement & Strength": `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M6.5 6.5h11v11h-11z"></path>
                    <path d="M6.5 6.5L12 12l5.5-5.5"></path>
                    <path d="M12 12l5.5 5.5"></path>
                </svg>`,
                "Thrive – Healthcare & Support": `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
                </svg>`
            };
            return icons[topic] || `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M12 6v6l4 2"></path>
            </svg>`;
        }

        // Helper function to get featured text (same as in blog-post.html)
        function getFeaturedText(topic) {
            const featuredTexts = {
                "Nourish – Food & Nutrition": "Discover balance through the 'Second Spring' philosophy, where renewal replaces decline, and energy flows with wisdom.",
                "Flow – Lifestyle Harmony": "Personalized daily rhythms, nutrition, and practices that restore harmony across mind, body, and hormones.",
                "Rest – Sleep & Recovery": "From symptom management to personalized insights, we merge research-backed knowledge with ancient systems to help women thrive today.",
                "Move – Movement & Strength": "Gentle activities like walking or yoga are enough on low-energy days. Strength training and cardio build resilience when energy is higher.",
                "Thrive – Healthcare & Support": "From symptom management to personalized insights, we merge research-backed knowledge with ancient systems to help women thrive today."
            };
            return featuredTexts[topic] || "Discover more insights to support your Second Spring journey.";
        }

        // Function to get the first image from a blog post file
        function getFirstImageFromBlogPost(postId) {
            // Map post IDs to their actual blog post files and first images
            const blogPostImages = {
                1: { file: "blog-perimenopause-exercise.html", image: "images/blog/Excercise_1.png" },
                2: { file: "blog-sleep-perimenopause.html", image: "images/blog/tips for improving sleep.png" },
                3: { file: "blog-hot-flashes.html", image: "images/blog/Hot Flash Reporting Comparison.png" },
                4: { file: "blog-nutrition-tips.html", image: "images/blog/Perimenopause Food Guidance Map.png" },
                5: { file: "blog-hormone-therapy.html", image: "images/blog/hormones.png" },
                6: { file: "blog-beginning-second-spring.html", image: "images/blog/Spring.png" }
            };
            
            return blogPostImages[postId] || { file: "blog-post.html", image: "images/blog/Spring.png" };
        }

        // Load latest posts in masonry layout
        function loadMasonryPosts(filterTopic = null) {
            const masonryContainer = document.getElementById('masonryGrid');
            if (!masonryContainer) return;

            // Filter posts by topic if specified
            let postsToShow;
            if (filterTopic) {
                postsToShow = blogPosts.filter(post => post.topic === filterTopic);
                // Update the section header
                const sectionHeader = document.querySelector('.latest-posts-header h2');
                if (sectionHeader) {
                    sectionHeader.textContent = `${getTopicShortName(filterTopic)} Articles`;
                }
                // Add back button
                addBackToAllButton();
            } else {
                // Get the latest 6 posts
                postsToShow = blogPosts.slice(0, 6);
                // Reset the section header
                const sectionHeader = document.querySelector('.latest-posts-header h2');
                if (sectionHeader) {
                    sectionHeader.textContent = 'Latest Articles';
                }
                // Remove back button if it exists
                removeBackToAllButton();
            }
            
            masonryContainer.innerHTML = postsToShow.map(post => {
                const categoryTag = post.topic ? getTopicShortName(post.topic) : 'General';
                const featuredText = post.excerpt.substring(0, 100) + '...';
                const blogPostData = getFirstImageFromBlogPost(post.id);
                
                return `
                    <a href="${blogPostData.file}" class="masonry-item" data-post-id="${post.id}">
                        <div class="masonry-image">
                            <img src="${blogPostData.image}" alt="${post.title}" loading="lazy">
                            <div class="masonry-overlay">
                                <div class="masonry-category">${categoryTag}</div>
                            </div>
                        </div>
                        <div class="masonry-content">
                            <h3 class="masonry-title">${post.title}</h3>
                            <p class="masonry-excerpt">${featuredText}</p>
                            <span class="masonry-read-more">Read More</span>
                        </div>
                    </a>
                `;
            }).join('');
        }

        // Helper function to get topic short names
        function getTopicShortName(topic) {
            const shortNames = {
                "Nourish – Food & Nutrition": "Nourish",
                "Flow – Lifestyle Harmony": "Flow", 
                "Rest – Sleep & Recovery": "Rest",
                "Move – Movement & Strength": "Move",
                "Thrive – Healthcare & Support": "Thrive"
            };
            return shortNames[topic] || topic;
        }

        // Add back to all articles button
        function addBackToAllButton() {
            const header = document.querySelector('.latest-posts-header');
            if (header && !document.querySelector('.back-to-all-btn')) {
                const backButton = document.createElement('a');
                backButton.href = 'blog.html';
                backButton.className = 'back-to-all-btn';
                backButton.textContent = '← Back to All Articles';
                backButton.style.cssText = `
                    display: inline-block;
                    margin-top: 1rem;
                    padding: 0.5rem 1rem;
                    background: var(--blue);
                    color: var(--white);
                    text-decoration: none;
                    border-radius: 6px;
                    font-size: 0.9rem;
                    transition: background 0.2s ease;
                `;
                backButton.addEventListener('mouseenter', () => {
                    backButton.style.background = '#1e6a89';
                });
                backButton.addEventListener('mouseleave', () => {
                    backButton.style.background = 'var(--blue)';
                });
                header.appendChild(backButton);
            }
        }

        // Remove back to all articles button
        function removeBackToAllButton() {
            const backButton = document.querySelector('.back-to-all-btn');
            if (backButton) {
                backButton.remove();
            }
        }


    </script>
</body>
</html>
